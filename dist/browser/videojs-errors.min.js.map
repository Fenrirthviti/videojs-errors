{"version":3,"sources":["node_modules/videojs-spellbook/node_modules/browserify/node_modules/browser-pack/_prelude.js","node_modules/global/document.js","node_modules/global/window.js","src/js/index.js"],"names":["f","exports","module","define","amd","g","window","global","self","this","videojsErrors","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","1","doccy","topLevel","minDoc","document","win","_interopDefault","ex","_typeof","videojs","FlashObj","getComponent","defaultDismiss","browser","IS_IPHONE","registerPlugin","plugin","defaults","header","message","timeout","dismiss","progressDisabled","errors","type","headline","2","3","4","5","unknown","-1","-2","-3","-4","-5","initPlugin","player","options","monitor","listeners","resetMonitor","clearTimeout","setTimeout","error","paused","ended","cleanup","listener","shift","off","healthcheck","fn","check","tech","$","vjs_getProperty","on","push","onPlayStartMonitor","lastTime","currentTime","onPlayNoSource","currentSrc","onErrorHandler","details","content","createElement","dialogContent","mergeOptions","localize","isSupported","display","getChild","className","id","closeable","innerHTML","fillWith","contentEl","firstChild","appendChild","el","okButton","querySelector","close","currentWidth","currentHeight","addClass","one","onDisposeHandler","removeClass","reInitPlugin","newOptions","extend","disableProgress","disabled","ready"],"mappings":"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","file":"/Users/jforbes/git/videojs-errors/dist/browser/videojs-errors.min.js","sourceRoot":"","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","var topLevel = typeof global !== 'undefined' ? global :\n    typeof window !== 'undefined' ? window : {}\nvar minDoc = require('min-document');\n\nvar doccy;\n\nif (typeof document !== 'undefined') {\n    doccy = document;\n} else {\n    doccy = topLevel['__GLOBAL_DOCUMENT_CACHE@4'];\n\n    if (!doccy) {\n        doccy = topLevel['__GLOBAL_DOCUMENT_CACHE@4'] = minDoc;\n    }\n}\n\nmodule.exports = doccy;\n","var win;\n\nif (typeof window !== \"undefined\") {\n    win = window;\n} else if (typeof global !== \"undefined\") {\n    win = global;\n} else if (typeof self !== \"undefined\"){\n    win = self;\n} else {\n    win = {};\n}\n\nmodule.exports = win;\n","'use strict';\n\nfunction _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }\n\nvar videojs = _interopDefault(require('video.js'));\nvar window = _interopDefault(require('global/window'));\nvar document = _interopDefault(require('global/document'));\n\nconst FlashObj = videojs.getComponent('Flash');\nconst defaultDismiss = !videojs.browser.IS_IPHONE;\n\n// Video.js 5/6 cross-compatibility.\nconst registerPlugin = videojs.registerPlugin || videojs.plugin;\n\n// Default options for the plugin.\nconst defaults = {\n  header: '',\n  code: '',\n  message: '',\n  timeout: 45 * 1000,\n  dismiss: defaultDismiss,\n  progressDisabled: false,\n  errors: {\n    '1': {\n      type: 'MEDIA_ERR_ABORTED',\n      headline: 'The video download was cancelled'\n    },\n    '2': {\n      type: 'MEDIA_ERR_NETWORK',\n      headline: 'The video connection was lost, please confirm you are ' +\n                'connected to the internet'\n    },\n    '3': {\n      type: 'MEDIA_ERR_DECODE',\n      headline: 'The video is bad or in a format that cannot be played on your browser'\n    },\n    '4': {\n      type: 'MEDIA_ERR_SRC_NOT_SUPPORTED',\n      headline: 'This video is either unavailable or not supported in this browser'\n    },\n    '5': {\n      type: 'MEDIA_ERR_ENCRYPTED',\n      headline: 'The video you are trying to watch is encrypted and we do not know how ' +\n                'to decrypt it'\n    },\n    'unknown': {\n      type: 'MEDIA_ERR_UNKNOWN',\n      headline: 'An unanticipated problem was encountered, check back soon and try again'\n    },\n    '-1': {\n      type: 'PLAYER_ERR_NO_SRC',\n      headline: 'No video has been loaded'\n    },\n    '-2': {\n      type: 'PLAYER_ERR_TIMEOUT',\n      headline: 'Could not download the video'\n    },\n    '-3': {\n      type: 'PLAYER_ERR_DOMAIN_RESTRICTED',\n      headline: 'This video is restricted from playing on your current domain'\n    },\n    '-4': {\n      type: 'PLAYER_ERR_IP_RESTRICTED',\n      headline: 'This video is restricted at your current IP address'\n    },\n    '-5': {\n      type: 'PLAYER_ERR_GEO_RESTRICTED',\n      headline: 'This video is restricted from playing in your current geographic region'\n    }\n  }\n};\n\n/**\n * Monitors a player for signs of life during playback and\n * triggers PLAYER_ERR_TIMEOUT if none occur within a reasonable\n * timeframe.\n */\nconst initPlugin = function(player, options) {\n  let monitor;\n  const listeners = [];\n\n  // clears the previous monitor timeout and sets up a new one\n  const resetMonitor = function() {\n    window.clearTimeout(monitor);\n    monitor = window.setTimeout(function() {\n      // player already has an error\n      // or is not playing under normal conditions\n      if (player.error() || player.paused() || player.ended()) {\n        return;\n      }\n\n      player.error({\n        code: -2,\n        type: 'PLAYER_ERR_TIMEOUT'\n      });\n    }, options.timeout);\n\n    // clear out any existing player timeout\n    // playback has recovered\n    if (player.error() && player.error().code === -2) {\n      player.error(null);\n    }\n  };\n\n  // clear any previously registered listeners\n  const cleanup = function() {\n    let listener;\n\n    while (listeners.length) {\n      listener = listeners.shift();\n      player.off(listener[0], listener[1]);\n    }\n    window.clearTimeout(monitor);\n  };\n\n  // creates and tracks a player listener if the player looks alive\n  const healthcheck = function(type, fn) {\n    const check = function() {\n      // if there's an error do not reset the monitor and\n      // clear the error unless time is progressing\n      if (!player.error()) {\n        // error if using Flash and its API is unavailable\n        const tech = player.$('.vjs-tech');\n\n        if (tech &&\n            tech.type === 'application/x-shockwave-flash' &&\n            !tech.vjs_getProperty) {\n          player.error({\n            code: -2,\n            type: 'PLAYER_ERR_TIMEOUT'\n          });\n          return;\n        }\n\n        // playback isn't expected if the player is paused\n        if (player.paused()) {\n          return resetMonitor();\n        }\n        // playback isn't expected once the video has ended\n        if (player.ended()) {\n          return resetMonitor();\n        }\n      }\n\n      fn.call(this);\n    };\n\n    player.on(type, check);\n    listeners.push([type, check]);\n  };\n\n  const onPlayStartMonitor = function() {\n    let lastTime = 0;\n\n    cleanup();\n\n    // if no playback is detected for long enough, trigger a timeout error\n    resetMonitor();\n    healthcheck(['timeupdate', 'adtimeupdate'], function() {\n      const currentTime = player.currentTime();\n\n      // playback is operating normally or has recovered\n      if (currentTime !== lastTime) {\n        lastTime = currentTime;\n        resetMonitor();\n      }\n    });\n\n    if (!options.progressDisabled) {\n      healthcheck('progress', resetMonitor);\n    }\n  };\n\n  const onPlayNoSource = function() {\n    if (!player.currentSrc()) {\n      player.error({\n        code: -1,\n        type: 'PLAYER_ERR_NO_SRC'\n      });\n    }\n  };\n\n  const onErrorHandler = function() {\n    let details = '';\n    let error = player.error();\n    const content = document.createElement('div');\n    let dialogContent = '';\n\n    // In the rare case when `error()` does not return an error object,\n    // defensively escape the handler function.\n    if (!error) {\n      return;\n    }\n\n    error = videojs.mergeOptions(error, options.errors[error.code || 0]);\n\n    if (error.message) {\n      details = `<div class=\"vjs-errors-details\">${player.localize('Technical details')}\n        : <div class=\"vjs-errors-message\">${player.localize(error.message)}</div>\n        </div>`;\n    }\n\n    if (error.code === 4 && FlashObj && !FlashObj.isSupported()) {\n      const flashMessage = player.localize('If you are using an older browser please try upgrading or installing Flash.');\n\n      details += `<span class=\"vjs-errors-flashmessage\">${flashMessage}</span>`;\n    }\n\n    const display = player.getChild('errorDisplay');\n\n    content.className = 'vjs-errors-dialog';\n    content.id = 'vjs-errors-dialog';\n    dialogContent =\n     `<div class=\"vjs-errors-content-container\">\n      <h2 class=\"vjs-errors-headline\">${this.localize(error.headline)}</h2>\n        <div><b>${this.localize('Error Code')}</b>: ${(error.type || error.code)}</div>\n        ${details}\n      </div>`;\n\n    const closeable = display.closeable(!('dismiss' in error) || error.dismiss);\n\n    // We should get a close button\n    if (closeable) {\n      dialogContent +=\n       `<div class=\"vjs-errors-ok-button-container\">\n          <button class=\"vjs-errors-ok-button\">${this.localize('OK')}</button>\n        </div>`;\n      content.innerHTML = dialogContent;\n      display.fillWith(content);\n      // Get the close button inside the error display\n      display.contentEl().firstChild.appendChild(display.getChild('closeButton').el());\n\n      const okButton = display.el().querySelector('.vjs-errors-ok-button');\n\n      player.on(okButton, 'click', function() {\n        display.close();\n      });\n    } else {\n      content.innerHTML = dialogContent;\n      display.fillWith(content);\n    }\n\n    if (player.currentWidth() <= 600 || player.currentHeight() <= 250) {\n      display.addClass('vjs-xs');\n    }\n\n    display.one('modalclose', () => player.error(null));\n  };\n\n  const onDisposeHandler = function() {\n    cleanup();\n\n    player.removeClass('vjs-errors');\n    player.off('play', onPlayStartMonitor);\n    player.off('play', onPlayNoSource);\n    player.off('dispose', onDisposeHandler);\n    player.off('error', onErrorHandler);\n  };\n\n  const reInitPlugin = function(newOptions) {\n    onDisposeHandler();\n    initPlugin(player, videojs.mergeOptions(defaults, newOptions));\n  };\n\n  reInitPlugin.extend = function(errors) {\n    options.errors = videojs.mergeOptions(options.errors, errors);\n  };\n\n  reInitPlugin.disableProgress = function(disabled) {\n    options.progressDisabled = disabled;\n    onPlayStartMonitor();\n  };\n\n  player.on('play', onPlayStartMonitor);\n  player.on('play', onPlayNoSource);\n  player.on('dispose', onDisposeHandler);\n  player.on('error', onErrorHandler);\n\n  player.ready(() => {\n    player.addClass('vjs-errors');\n  });\n\n  player.errors = reInitPlugin;\n};\n\n/**\n * Initialize the plugin. Waits until the player is ready to do anything.\n */\nconst errors = function(options) {\n  initPlugin(this, videojs.mergeOptions(defaults, options));\n};\n\n// Register the plugin with video.js.\nregisterPlugin('errors', errors);\n\nmodule.exports = errors;\n"]}