{"version":3,"sources":["node_modules/videojs-spellbook/node_modules/browserify/node_modules/browser-pack/_prelude.js","node_modules/global/document.js","node_modules/global/window.js","src/js/index.js"],"names":["f","exports","module","define","amd","g","window","global","self","this","videojsErrors","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","1","topLevel","minDoc","document","doccy","_interopDefault","ex","_typeof","videojs","FlashObj","getComponent","defaultDismiss","browser","IS_IPHONE","registerPlugin","plugin","defaults","header","message","timeout","dismiss","errors","type","headline","2","3","4","5","unknown","-1","-2","-3","-4","-5","initPlugin","player","options","monitor","listeners","resetMonitor","clearTimeout","setTimeout","error","paused","ended","cleanup","listener","shift","off","healthcheck","fn","check","tech","$","vjs_getProperty","on","push","onPlayStartMonitor","lastTime","currentTime","onPlayNoSource","currentSrc","onErrorHandler","details","content","createElement","dialogContent","mergeOptions","localize","isSupported","display","getChild","className","id","closeable","innerHTML","fillWith","contentEl","firstChild","appendChild","el","okButton","querySelector","close","width","height","addClass","one","onDisposeHandler","removeClass","reInitPlugin","newOptions","extend","ready"],"mappings":"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","file":"/Users/poneill/dev/videojs-errors/dist/browser/videojs-errors.min.js","sourceRoot":"","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","var topLevel = typeof global !== 'undefined' ? global :\n    typeof window !== 'undefined' ? window : {}\nvar minDoc = require('min-document');\n\nif (typeof document !== 'undefined') {\n    module.exports = document;\n} else {\n    var doccy = topLevel['__GLOBAL_DOCUMENT_CACHE@4'];\n\n    if (!doccy) {\n        doccy = topLevel['__GLOBAL_DOCUMENT_CACHE@4'] = minDoc;\n    }\n\n    module.exports = doccy;\n}\n","if (typeof window !== \"undefined\") {\n    module.exports = window;\n} else if (typeof global !== \"undefined\") {\n    module.exports = global;\n} else if (typeof self !== \"undefined\"){\n    module.exports = self;\n} else {\n    module.exports = {};\n}\n","'use strict';\n\nfunction _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }\n\nvar videojs = _interopDefault(require('video.js'));\nvar window = _interopDefault(require('global/window'));\nvar document = _interopDefault(require('global/document'));\n\nconst FlashObj = videojs.getComponent('Flash');\nconst defaultDismiss = !videojs.browser.IS_IPHONE;\n\n// Video.js 5/6 cross-compatibility.\nconst registerPlugin = videojs.registerPlugin || videojs.plugin;\n\n// Default options for the plugin.\nconst defaults = {\n  header: '',\n  code: '',\n  message: '',\n  timeout: 45 * 1000,\n  dismiss: defaultDismiss,\n  errors: {\n    '1': {\n      type: 'MEDIA_ERR_ABORTED',\n      headline: 'The video download was cancelled'\n    },\n    '2': {\n      type: 'MEDIA_ERR_NETWORK',\n      headline: 'The video connection was lost, please confirm you are ' +\n                'connected to the internet'\n    },\n    '3': {\n      type: 'MEDIA_ERR_DECODE',\n      headline: 'The video is bad or in a format that cannot be played on your browser'\n    },\n    '4': {\n      type: 'MEDIA_ERR_SRC_NOT_SUPPORTED',\n      headline: 'This video is either unavailable or not supported in this browser'\n    },\n    '5': {\n      type: 'MEDIA_ERR_ENCRYPTED',\n      headline: 'The video you are trying to watch is encrypted and we do not know how ' +\n                'to decrypt it'\n    },\n    'unknown': {\n      type: 'MEDIA_ERR_UNKNOWN',\n      headline: 'An unanticipated problem was encountered, check back soon and try again'\n    },\n    '-1': {\n      type: 'PLAYER_ERR_NO_SRC',\n      headline: 'No video has been loaded'\n    },\n    '-2': {\n      type: 'PLAYER_ERR_TIMEOUT',\n      headline: 'Could not download the video'\n    },\n    '-3': {\n      type: 'PLAYER_ERR_DOMAIN_RESTRICTED',\n      headline: 'This video is restricted from playing on your current domain'\n    },\n    '-4': {\n      type: 'PLAYER_ERR_IP_RESTRICTED',\n      headline: 'This video is restricted at your current IP address'\n    },\n    '-5': {\n      type: 'PLAYER_ERR_GEO_RESTRICTED',\n      headline: 'This video is restricted from playing in your current geographic region'\n    }\n  }\n};\n\n/**\n * Monitors a player for signs of life during playback and\n * triggers PLAYER_ERR_TIMEOUT if none occur within a reasonable\n * timeframe.\n */\nconst initPlugin = function(player, options) {\n  let monitor;\n  const listeners = [];\n\n  // clears the previous monitor timeout and sets up a new one\n  const resetMonitor = function() {\n    window.clearTimeout(monitor);\n    monitor = window.setTimeout(function() {\n      // player already has an error\n      // or is not playing under normal conditions\n      if (player.error() || player.paused() || player.ended()) {\n        return;\n      }\n\n      player.error({\n        code: -2,\n        type: 'PLAYER_ERR_TIMEOUT'\n      });\n    }, options.timeout);\n\n    // clear out any existing player timeout\n    // playback has recovered\n    if (player.error() && player.error().code === -2) {\n      player.error(null);\n    }\n  };\n\n  // clear any previously registered listeners\n  const cleanup = function() {\n    let listener;\n\n    while (listeners.length) {\n      listener = listeners.shift();\n      player.off(listener[0], listener[1]);\n    }\n    window.clearTimeout(monitor);\n  };\n\n  // creates and tracks a player listener if the player looks alive\n  const healthcheck = function(type, fn) {\n    const check = function() {\n      // if there's an error do not reset the monitor and\n      // clear the error unless time is progressing\n      if (!player.error()) {\n        // error if using Flash and its API is unavailable\n        const tech = player.$('.vjs-tech');\n\n        if (tech &&\n            tech.type === 'application/x-shockwave-flash' &&\n            !tech.vjs_getProperty) {\n          player.error({\n            code: -2,\n            type: 'PLAYER_ERR_TIMEOUT'\n          });\n          return;\n        }\n\n        // playback isn't expected if the player is paused\n        if (player.paused()) {\n          return resetMonitor();\n        }\n        // playback isn't expected once the video has ended\n        if (player.ended()) {\n          return resetMonitor();\n        }\n      }\n\n      fn.call(this);\n    };\n\n    player.on(type, check);\n    listeners.push([type, check]);\n  };\n\n  const onPlayStartMonitor = function() {\n    let lastTime = 0;\n\n    cleanup();\n\n    // if no playback is detected for long enough, trigger a timeout error\n    resetMonitor();\n    healthcheck(['timeupdate', 'adtimeupdate'], function() {\n      const currentTime = player.currentTime();\n\n      // playback is operating normally or has recovered\n      if (currentTime !== lastTime) {\n        lastTime = currentTime;\n        resetMonitor();\n      }\n    });\n    healthcheck('progress', resetMonitor);\n  };\n\n  const onPlayNoSource = function() {\n    if (!player.currentSrc()) {\n      player.error({\n        code: -1,\n        type: 'PLAYER_ERR_NO_SRC'\n      });\n    }\n  };\n\n  const onErrorHandler = function() {\n    let details = '';\n    let error = player.error();\n    const content = document.createElement('div');\n    let dialogContent = '';\n\n    // In the rare case when `error()` does not return an error object,\n    // defensively escape the handler function.\n    if (!error) {\n      return;\n    }\n\n    error = videojs.mergeOptions(error, options.errors[error.code || 0]);\n\n    if (error.message) {\n      details = `<div class=\"vjs-errors-details\">${player.localize('Technical details')}\n        : <div class=\"vjs-errors-message\">${player.localize(error.message)}</div>\n        </div>`;\n    }\n\n    if (error.code === 4 && FlashObj && !FlashObj.isSupported()) {\n      const flashMessage = player.localize('If you are using an older browser please try upgrading or installing Flash.');\n\n      details += `<span class=\"vjs-errors-flashmessage\">${flashMessage}</span>`;\n    }\n\n    const display = player.getChild('errorDisplay');\n\n    content.className = 'vjs-errors-dialog';\n    content.id = 'vjs-errors-dialog';\n    dialogContent =\n     `<div class=\"vjs-errors-content-container\">\n      <h2 class=\"vjs-errors-headline\">${this.localize(error.headline)}</h2>\n        <div><b>${this.localize('Error Code')}</b>: ${(error.type || error.code)}</div>\n        ${details}\n      </div>`;\n\n    const closeable = display.closeable(!('dismiss' in error) || error.dismiss);\n\n    // We should get a close button\n    if (closeable) {\n      dialogContent +=\n       `<div class=\"vjs-errors-ok-button-container\">\n          <button class=\"vjs-errors-ok-button\">${this.localize('OK')}</button>\n        </div>`;\n      content.innerHTML = dialogContent;\n      display.fillWith(content);\n      // Get the close button inside the error display\n      display.contentEl().firstChild.appendChild(display.getChild('closeButton').el());\n\n      const okButton = display.el().querySelector('.vjs-errors-ok-button');\n\n      player.on(okButton, 'click', function() {\n        display.close();\n      });\n    } else {\n      content.innerHTML = dialogContent;\n      display.fillWith(content);\n    }\n\n    if (player.width() <= 600 || player.height() <= 250) {\n      display.addClass('vjs-xs');\n    }\n\n    display.one('modalclose', () => player.error(null));\n  };\n\n  const onDisposeHandler = function() {\n    cleanup();\n\n    player.removeClass('vjs-errors');\n    player.off('play', onPlayStartMonitor);\n    player.off('play', onPlayNoSource);\n    player.off('dispose', onDisposeHandler);\n    player.off('error', onErrorHandler);\n  };\n\n  const reInitPlugin = function(newOptions) {\n    onDisposeHandler();\n    initPlugin(player, videojs.mergeOptions(defaults, newOptions));\n  };\n\n  reInitPlugin.extend = function(errors) {\n    options.errors = videojs.mergeOptions(options.errors, errors);\n  };\n\n  player.on('play', onPlayStartMonitor);\n  player.on('play', onPlayNoSource);\n  player.on('dispose', onDisposeHandler);\n  player.on('error', onErrorHandler);\n\n  player.ready(() => {\n    player.addClass('vjs-errors');\n  });\n\n  player.errors = reInitPlugin;\n};\n\n/**\n * Initialize the plugin. Waits until the player is ready to do anything.\n */\nconst errors = function(options) {\n  initPlugin(this, videojs.mergeOptions(defaults, options));\n};\n\n// Register the plugin with video.js.\nregisterPlugin('errors', errors);\n\nmodule.exports = errors;\n"]}